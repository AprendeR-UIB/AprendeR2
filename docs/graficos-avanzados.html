<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Lección 1 Gráficos avanzados | AprendeR: Parte II</title>
  <meta name="description" content="Apuntes AprendeR bookdown::gitbook.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Lección 1 Gráficos avanzados | AprendeR: Parte II" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Apuntes AprendeR bookdown::gitbook." />
  <meta name="github-repo" content="AprendeR-UIB/AprendeR2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lección 1 Gráficos avanzados | AprendeR: Parte II" />
  
  <meta name="twitter:description" content="Apuntes AprendeR bookdown::gitbook." />
  

<meta name="author" content="The UIB-AprendeR team">


<meta name="date" content="2020-03-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/d3-3.5.3/d3.min.js"></script>
<link href="libs/colorbrewer-1/colorbrewer.css" rel="stylesheet" />
<script src="libs/colorbrewer-1/colorbrewer.js"></script>
<link href="libs/streamgraph-1/streamgraph.css" rel="stylesheet" />
<script src="libs/streamgraph-binding-0.9.0/streamgraph.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">AprendeR: Parte II</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Presentación</a></li>
<li class="chapter" data-level="1" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html"><i class="fa fa-check"></i><b>1</b> Gráficos avanzados</a><ul>
<li class="chapter" data-level="1.1" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html#nubes-de-palabras-o-de-etiquetas-word-clouds"><i class="fa fa-check"></i><b>1.1</b> Nubes de palabras o de etiquetas (<em>word clouds</em>)</a></li>
<li class="chapter" data-level="1.2" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html#mapa-de-calor-o-heatmap"><i class="fa fa-check"></i><b>1.2</b> Mapa de calor o <em>heatmap</em></a></li>
<li class="chapter" data-level="1.3" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html#dendrogramas"><i class="fa fa-check"></i><b>1.3</b> Dendrogramas</a></li>
<li class="chapter" data-level="1.4" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html#graficos-de-burbujas-o-bubbles"><i class="fa fa-check"></i><b>1.4</b> Gráficos de burbujas o <em>bubbles</em></a></li>
<li class="chapter" data-level="1.5" data-path="graficos-avanzados.html"><a href="graficos-avanzados.html#graficos-de-corrientes-o-streamgraphs"><i class="fa fa-check"></i><b>1.5</b> Gráficos de corrientes o <em>streamgraphs</em></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AprendeR: Parte II</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="graficos-avanzados" class="section level1">
<h1><span class="header-section-number">Lección 1</span> Gráficos avanzados</h1>
<p>La capacidad que tiene R para representar gráficamente datos es
asombrosa y explicar todos los gráficos que puede producir nos llevaría
un curso entero. Por este motivo, en esta lección nos limitaremos a daros una idea de sus capacidades gráficas, explicando unos cuantos gráficos avanzados que se pueden producir con R de manera sencilla, sin
entrar en el detalle de los algoritmos que los
generan.</p>
<div id="nubes-de-palabras-o-de-etiquetas-word-clouds" class="section level2">
<h2><span class="header-section-number">1.1</span> Nubes de palabras o de etiquetas (<em>word clouds</em>)</h2>
<p>Una <em>nube de palabras</em>, o <em>de etiquetas</em>, (<em>word cloud</em>) es un gráfico formado por las palabras de un texto, organizadas en forma de nube. Las palabras se representan en la nube de manera que a mayor frecuencia en el texto y, por tanto, a mayor importancia en este
sentido, mayor sea su tamaño. Las frecuencias de las palabras también se pueden indicar por medio de una gradación de color.</p>
<p>Para crear una nube de palabras con R, necesitamos cargar los paquetes <code>tm</code> (de <em>text mining</em>), para tratar y manipular textos, y <code>wordcloud</code>, para dibujar la nube de palabras.
En primer lugar veremos cómo usar las funciones del paquete <code>tm</code> con el fin de extraer la información de un documento que nos permitirá producir su nube de
palabras.</p>
<p>La estructura principal para el manejo de documentos en el paquete <code>tm</code> es el <em>Corpus</em>, que representa una colección de textos. La
implementación básica que lleva dicho paquete de un <em>Corpus</em>, y que es la que usaremos aquí, es el <em>Corpus volátil</em>,
<em>VCorpus</em>, que viene a ser una representación
volátil de los documentos en la memoria de R. Decimos volátil
porque una vez que el objeto de R en cuestión es borrado, el corpus de los
documentos también se borra de la memoria. Para cargar un conjunto de documentos en un <em>VCorpus</em>,
usamos la instrucción</p>
<pre class="sourceCode r"><code class="sourceCode r">nombre=<span class="st"> </span><span class="kw">VCorpus</span>(<span class="st">&quot;lugar&quot;</span>, <span class="dt">readerControl=</span>...)</code></pre>
<p>donde:</p>
<ul>
<li><p>El primer parámetro es el <em>lugar</em> de donde R tiene que cargar los documentos a analizar. Si forman el contenido de un directorio, se especifica con <code>DirSource(&quot;directorio&quot;)</code>, mientras que, para cargar el código fuente de una página web, se tiene que usar <code>URISource(&quot;url&quot;)</code>.
Para conocer el resto de funciones que se pueden usar para entrar este <em>lugar</em>, podéis consultar la Ayuda de la función <code>Source</code>. En todas ellas se puede especificar con <code>encoding</code> la codificación de alfabeto; es conveniente hacerlo si los documentos contienen palabras acentuadas o caracteres especiales.</p></li>
<li><p>El parámetro <code>readerControl</code> es una <code>list</code> de dos componentes: <code>reader</code> y <code>language</code>. La componente <code>reader</code> indica la función que ha de usar R para leer y procesar los documentos contenidos en el <em>lugar</em> especificado, que dependerá de su formato; aquí solo consideraremos el análisis de documentos en formato texto, que corresponde al valor por defecto de <code>reader</code>, y por lo tanto podemos omitir esta componente en la <code>list</code> (si tenéis curiosidad, corresponde a <code>reader=readPlain</code>). Si queréis procesar otro tipo de documentos, os recomendamos que, al menos al principio, primero los convirtáis en ficheros de texto ordinario.</p></li>
</ul>
<p>Por su lado, el parámetro <code>language</code> indica el idioma en que está el texto, o los textos, a procesar. Se ha de entrar igualado al código ISO 639-2 del idioma <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> entrecomillado: <code>en</code> para inglés, <code>spa</code> para español, <code>tlh</code> para klingon, etc.</p>
<p>Vamos a desarrollar un ejemplo completo. Hemos guardado en un subdirectorio llamado <em>Wordcloud</em> del directorio de trabajo dos documentos: un fichero <code>lomce.txt</code> con el texto de la Ley orgánica 8/2013, de 9 de diciembre, para la mejora de la calidad educativa, más conocida como LOMCE,<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> que será el que analizaremos, y un fichero <code>introR.txt</code> con el primer párrafo de esta lección, que no analizaremos y simplemente nos servirá para ver el efecto de algunas transformaciones.</p>
<p>Vamos a cargar estos dos documentos en un <em>VCorpus</em> llamado <code>Prueba</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tm)
Prueba=<span class="kw">VCorpus</span>(<span class="kw">DirSource</span>(<span class="st">&quot;Wordcloud&quot;</span>, <span class="dt">encoding=</span><span class="st">&quot;UTF-8&quot;</span>), 
<span class="dt">readerControl=</span><span class="kw">list</span>(<span class="dt">language=</span><span class="st">&quot;spa&quot;</span>))</code></pre>
<p>Hemos añadido <code>encoding=&quot;UTF-8&quot;</code> porque así es como hemos guardado los ficheros de texto en nuestro ordenador y como contienen letras acentuadas, mejor curarnos en salud. Como están en español, hemos especificado <code>language=&quot;spa&quot;</code> en <code>readerControl</code>, y en cambio no hemos especificado la componente <code>reader</code> de esta <code>list</code> porque se trata de ficheros de texto.</p>
<p>A continuación, vamos a inspeccionar el <em>Corpus</em> cargado. Aplicándole la función <code>inspect</code>, obtenemos cuántos documentos contiene y, para cada uno, su número de caracteres y su formato.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inspect</span>(Prueba)</code></pre>
<pre><code>## &lt;&lt;VCorpus&gt;&gt;
## Metadata:  corpus specific: 0, document level (indexed): 0
## Content:  documents: 2
## 
## [[1]]
## &lt;&lt;PlainTextDocument&gt;&gt;
## Metadata:  7
## Content:  chars: 3576
## 
## [[2]]
## &lt;&lt;PlainTextDocument&gt;&gt;
## Metadata:  7
## Content:  chars: 214377</code></pre>
<p>De esta manera vemos que R ha incorporado al <code>VCorpus</code> los documentos por orden alfabético de su título: el primero es el corto, <code>introR.txt</code>, y el segundo, el largo, <code>lomce.txt</code>.</p>
<p>Con la instrucción <code>writeLines(as.character(VCorpus[[k]]))</code> obtenemos en la consola el contenido completo del <span class="math inline">\(k\)</span>-ésimo texto de nuestro <em>VCorpus</em>. Veamos, por ejemplo, el contenido del texto corto:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="kw">as.character</span>(Prueba[[<span class="dv">1</span>]]))</code></pre>
<pre><code>## El alumnado es el centro y la razón de ser de la educación. El aprendizaje en la escuela debe ir dirigido a formar personas autónomas, críticas, con pensamiento propio. 
## Todos los alumnos y alumnas tienen un sueño, todas las personas jóvenes tienen talento. Nuestras personas y sus talentos son lo más valioso que tenemos como país.
## 
## Por ello, todos y cada uno de los alumnos y alumnas serán objeto de una atención, en la búsqueda de desarrollo del talento, que convierta la educación en el principal 
## instrumento de movilidad social, ayude a superar barreras económicas y sociales y genere aspiraciones y ambiciones realizables para todos. Para todos ellos esta Ley Orgánica 
## establece los necesarios mecanismos de permeabilidad y retorno entre las diferentes trayectorias y vías que en ella se articulan.
## 
## Todos los estudiantes poseen talento, pero la naturaleza de este talento difiere entre ellos. En consecuencia, el sistema educativo debe contar con los mecanismos necesarios 
## para reconocerlo y potenciarlo. El reconocimiento de esta diversidad entre alumno o alumna en sus habilidades y expectativas es el primer paso hacia el desarrollo de una 
## estructura educativa que contemple diferentes trayectorias. La lógica de esta reforma se basa en la evolución hacia un sistema capaz de encauzar a los estudiantes hacia las 
## trayectorias más adecuadas a sus capacidades, de forma que puedan hacer realidad sus aspiraciones y se conviertan en rutas que faciliten la empleabilidad y estimulen el 
## espíritu emprendedor a través de la posibilidad, para el alumnado y sus padres, madres o tutores legales, de elegir las mejores opciones de desarrollo personal y profesional. 
## Los estudiantes con problemas de rendimiento deben contar con programas específicos que mejoren sus posibilidades de continuar en el sistema.
## 
## Detrás de los talentos de las personas están los valores que los vertebran, las actitudes que los impulsan, las competencias que los materializan y los conocimientos que 
## los construyen. El reto de una sociedad democrática es crear las condiciones para que todos los alumnos y alumnas puedan adquirir y expresar sus talentos, en definitiva, 
## el compromiso con una educación de calidad como soporte de la igualdad y la justicia social.
## 
## La educación es el motor que promueve el bienestar de un país. El nivel educativo de los ciudadanos determina su capacidad de competir con éxito en el ámbito del panorama 
## internacional y de afrontar los desafíos que se planteen en el futuro. Mejorar el nivel de los ciudadanos en el ámbito educativo supone abrirles las puertas a puestos de 
## trabajo de alta cualificación, lo que representa una apuesta por el crecimiento económico y por un futuro mejor.
## 
## En la esfera individual, la educación supone facilitar el desarrollo personal y la integración social. El nivel educativo determina, en gran manera, las metas y expectativas 
## de la trayectoria vital, tanto en lo profesional como en lo personal, así como el conjunto de conocimientos, recursos y herramientas de aprendizaje que capacitan a una persona 
## para cumplir con éxito sus objetivos.
## 
## Solo un sistema educativo de calidad, inclusivo, integrador y exigente, garantiza la igualdad de oportunidades y hace efectiva la posibilidad de que cada alumno o alumna 
## desarrolle el máximo de sus potencialidades. Solo desde la calidad se podrá hacer efectivo el mandato del artículo 27.2 de la Constitución española: «La educación tendrá 
## por objeto el pleno desarrollo de la personalidad humana en el respeto a los principios democráticos de convivencia y a los derechos y libertades fundamentales».</code></pre>
<p>La capacidad que tiene R para representar gráficamente datos es asombrosa. Explicar todos los gráficos que puede producir R nos llevaría un curso entero, por lo que, en este capítulo, nos limitaremos a explicar la versión básica de unos cuantos gráficos avanzados que podemos producir con R de manera sencilla, para daros una idea de sus capacidades gráficas y sin entrar en detalles de los algoritmos que los producen.</p>
<p>Una vez que hemos guardado una serie de documentos en un <code>VCorpus</code>, tenemos que <em>limpiarlos</em>, en el sentido de eliminar, por ejemplo, signos de puntuación y palabras comunes sin ningún interés para que no aparezcan en la nube de palabras. Esto se lleva a cabo aplicando la función <code>tm_map</code> al <code>VCorpus</code> y a una <em>transformación</em>. Veamos algunos ejemplos:</p>
<ul>
<li>Convertimos todas las letras en minúsculas, para que R no considere diferentes dos palabras simplemente por la grafía de sus letras:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">Prueba=<span class="kw">tm_map</span>(Prueba, tolower)</code></pre>
<ul>
<li>Eliminamos los signos de puntuación:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">Prueba=<span class="kw">tm_map</span>(Prueba, removePunctuation)</code></pre>
<ul>
<li>Eliminamos las palabras <em>comodín</em>: preposiciones, artículos, algunos tiempos verbales de ser, estar y haber, etc. (si entráis en la consola la instrucción <code>stopwords(&quot;spanish&quot;)</code> veréis la lista de las palabras que se eliminan):</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">Prueba=<span class="kw">tm_map</span>(Prueba, removeWords, <span class="kw">stopwords</span>(<span class="st">&quot;spanish&quot;</span>))</code></pre>
<p>En general, con <code>Prueba=tm_map(Prueba, removeWords, vector)</code> podemos borrar un <em>vector</em> de palabras. Por ejemplo, vamos a eliminar también la palabra <em>artículo</em>, para evitar que aparezca en la nube de palabras de la LOMCE, y <em>r</em> (ya en minúsculas) para ver cómo desaparece del texto corto.</p>
<pre class="sourceCode r"><code class="sourceCode r">Prueba=<span class="kw">tm_map</span>(Prueba, removeWords, <span class="kw">c</span>(<span class="st">&quot;artículo&quot;</span>,<span class="st">&quot;r&quot;</span>))</code></pre>
<ul>
<li>Eliminamos los espacios en blanco extra:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">Prueba=<span class="kw">tm_map</span>(Prueba, stripWhitespace)</code></pre>
<p>Veamos como ha quedado el texto corto tras estas transformaciones:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="kw">as.character</span>(Prueba[[<span class="dv">1</span>]]))</code></pre>
<pre><code>##  alumnado centro razón ser educación aprendizaje escuela debe ir dirigido formar personas autónomas críticas pensamiento propio 
##  alumnos alumnas sueño todas personas jóvenes talento personas talentos valioso país
## 
##  ello cada alumnos alumnas objeto atención búsqueda desarrollo talento convierta educación principal 
## instrumento movilidad social ayude superar barreras económicas sociales genere aspiraciones ambiciones realizables ley orgánica 
## establece necesarios mecanismos permeabilidad retorno diferentes trayectorias vías articulan
## 
##  estudiantes poseen talento naturaleza talento difiere consecuencia sistema educativo debe contar mecanismos necesarios 
##  reconocerlo potenciarlo reconocimiento diversidad alumno alumna habilidades expectativas primer paso hacia desarrollo 
## estructura educativa contemple diferentes trayectorias lógica reforma basa evolución hacia sistema capaz encauzar estudiantes hacia 
## trayectorias adecuadas capacidades forma puedan hacer realidad aspiraciones conviertan rutas faciliten empleabilidad estimulen 
## espíritu emprendedor través posibilidad alumnado padres madres tutores legales elegir mejores opciones desarrollo personal profesional 
##  estudiantes problemas rendimiento deben contar programas específicos mejoren posibilidades continuar sistema
## 
## detrás talentos personas valores vertebran actitudes impulsan competencias materializan conocimientos 
##  construyen reto sociedad democrática crear condiciones alumnos alumnas puedan adquirir expresar talentos definitiva 
##  compromiso educación calidad soporte igualdad justicia social
## 
##  educación motor promueve bienestar país nivel educativo ciudadanos determina capacidad competir éxito ámbito panorama 
## internacional afrontar desafíos planteen futuro mejorar nivel ciudadanos ámbito educativo supone abrirles puertas puestos 
## trabajo alta cualificación representa apuesta crecimiento económico futuro mejor
## 
##  esfera individual educación supone facilitar desarrollo personal integración social nivel educativo determina gran manera metas expectativas 
##  trayectoria vital profesional personal así conjunto conocimientos recursos herramientas aprendizaje capacitan persona 
##  cumplir éxito objetivos
## 
## solo sistema educativo calidad inclusivo integrador exigente garantiza igualdad oportunidades hace efectiva posibilidad cada alumno alumna 
## desarrolle máximo potencialidades solo calidad podrá hacer efectivo mandato 272 constitución española « educación 
##  objeto pleno desarrollo personalidad humana respeto principios democráticos convivencia derechos libertades fundamentales»</code></pre>
<p>Otras transformaciones posibles que nosotros no hemos aplicado, son: <code>removeNumbers</code>, para eliminar los números,
y, cargando el paquete <code>SnowballC</code>, la transformación <code>stemDocument</code> (con, en nuestro ejemplo, <code>language=&quot;spanish&quot;</code>), que se queda sólo con las raíces de algunas palabras (y la nube de palabras que se produciría sería la de estas raíces: así, por ejemplo, en la de la LOMCE saldría <em>alumn</em> en lugar de <em>alumnos</em> y <em>alumnas</em>).</p>
<p>Ahora estamos en condiciones de construir la nube de palabras de la LOMCE. Para ello, usaremos la función <code>wordcloud</code> del paquete homónimo. Veamos su aplicación a nuestro caso concreto, y luego comentamos algunos parámetros:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wordcloud)
<span class="kw">wordcloud</span>(Prueba[[<span class="dv">2</span>]], <span class="dt">scale=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="fl">0.5</span>), <span class="dt">max.words=</span><span class="dv">100</span>, 
          <span class="dt">rot.per=</span><span class="fl">0.25</span>, <span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>))</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Obtenemos el gráfico anterior, donde observamos que las palabras más repetidas y, por tanto, en este sentido más importantes, son
<strong>educación</strong>, <strong>alumnos</strong>, <strong>alumnas</strong>, <strong>centros</strong>, etc.</p>
<p>Como vemos, la función <code>wordcloud</code> se aplica al documento, en este caso <code>Prueba[[2]]</code>, y
sus parámetros principales son los siguientes:</p>
<ul>
<li><p><code>scale</code>: un vector de longitud 2 que sirve para indicar la escala, o los tamaños relativos, de las palabras. Su primera entrada indica el tamaño de la palabra más repetida y la segunda, el de la palabra menos repetida.</p></li>
<li><p><code>max.words</code>: el número máximo de palabras a mostrar.</p></li>
<li><p><code>min.freq</code>: la frecuencia mínima necesaria para que una palabra aparezca en el gráfico.</p></li>
<li><p><code>rot.per</code>: la proporción de palabras que se pueden mostrar giradas 90 grados.</p></li>
<li><p><code>colors</code>: la paleta de colores usados para representar las frecuencias, en orden creciente. Nosotros hemos usado una paleta del paquete <code>RColorBrewer</code> explicado en la Sección 11.5 (y que se carga automáticamente junto con el paquete <code>wordcloud</code>).</p></li>
</ul>
<p>Algunos comentarios importantes:</p>
<ul>
<li><p>La posición de las palabras en la nube es aleatoria, de manera que puede variar en cada ejecución de la instrucción.</p></li>
<li><p>R procura evitar solapamientos de palabras, y eso hace que, según cómo las vaya colocando, algunas no le quepan: en este caso os avisará con un <code>warning</code> para cada palabra omitida. Algunas posibles soluciones son volver a repetir el gráfico hasta que el azar produzca una combinación en la que quepan todas, reducir el número de palabras en la nube o reducir el rango de tamaños de las palabras. Otra posibilidad es usar el parámetro
<code>random.order=FALSE</code>, que añade las palabras en orden decreciente de frecuencia, con lo que si hay palabras que no incluya, serán las menos importantes.</p></li>
<li><p>Si, al guardar la imagen, modificáis sus dimensiones, las palabras se recolocarán y puede que se superpongan (si reducís el gráfico) o se separen (si lo ampliáis). Procurad, al guardar la imagen, usar la opción <code>View plot after saving</code> para controlar el resultado final.</p></li>
</ul>
</div>
<div id="mapa-de-calor-o-heatmap" class="section level2">
<h2><span class="header-section-number">1.2</span> Mapa de calor o <em>heatmap</em></h2>
<p>Uno de los gráficos más usados en estadística multidimensional para representar la relación existente entre un conjunto de individuos o de variables es un <em>mapa de calor</em>, o <em>heatmap</em>. Por ejemplo, a partir de una tabla de datos, podemos producir un mapa de calor que represente las correlaciones de sus variables, para poder visualizar los pares de variables con mayor y menor relación lineal, o un mapa de calor que represente las diferencias (en algún sentido) entre sus individuos, para poder visualizar qué individuos se parecen más o menos. En realidad, el principio es el mismo que cuando producíamos histogramas 2D en la Lección 11: se representan gráficamente las entradas de una matriz (en aquel caso, tablas de contingencia bidimensionales de variables agrupadas) de manera que el tamaño de las entradas se simbolice mediante una gradación de colores.</p>
<p>La función básica para producir mapas de calor es <code>heatmap</code>, y se aplica a una matriz.
Para ilustrar su funcionamiento, vamos a ver dos ejemplos sobre una misma tabla de datos, y aprovecharemos para explicar algunos de sus parámetros.</p>

<div class="example">
<p><span id="exm:mtcars" class="example"><strong>Ejemplo 1.1  </strong></span>Consideremos la tabla de datos que lleva R llamada <code>mtcars</code>. Dicha tabla de datos contiene los valores de las 11 características siguientes (las variables) de 32 vehículos (las filas):</p>
<ul>
<li><code>mpg</code>: El consumo del vehículo en millas por galón de combustible.</li>
<li><code>cyl</code>: Su número de cilindros.</li>
<li><code>disp</code>: Su cilindrada.</li>
<li><code>hp</code>: Su número de caballos de potencia.</li>
<li><code>drat</code>: Su relación del eje trasero.</li>
<li><code>wt</code>: Su peso (en libras/1000).</li>
<li><code>qsec</code>: El tiempo que tarda en recorrer un cuarto de milla.</li>
<li><code>vs</code>: El tipo de motor: Motor en V (valor 0) o en línea (valor 1).</li>
<li><code>am</code>: El tipo de transmisión: 0 automática, 1 manual.</li>
<li><code>gear</code>: El número de marchas hacia adelante.</li>
<li><code>carb</code>: El número de carburadores.</li>
</ul>
Para estudiar los pares de variables que tienen más relación lineal, vamos a representar por medio de un <em>heatmap</em> la matriz de los valores absolutos de las correlaciones de las variables no binarias
(es decir, de todas menos <code>vs</code> y <code>am</code>, la octava y la novena respectivamente). Las instrucciones que usamos son las siguientes:
</div>

<pre class="sourceCode r"><code class="sourceCode r">mtcars2=mtcars[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">9</span>)]  <span class="co">#Eliminamos las variables binarias</span>
<span class="kw">round</span>(<span class="kw">abs</span>(<span class="kw">cor</span>(mtcars2)),<span class="dv">3</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>mpg</td>
<td align="right">1.000</td>
<td align="right">0.852</td>
<td align="right">0.848</td>
<td align="right">0.776</td>
<td align="right">0.681</td>
<td align="right">0.868</td>
<td align="right">0.419</td>
<td align="right">0.480</td>
<td align="right">0.551</td>
</tr>
<tr class="even">
<td>cyl</td>
<td align="right">0.852</td>
<td align="right">1.000</td>
<td align="right">0.902</td>
<td align="right">0.832</td>
<td align="right">0.700</td>
<td align="right">0.782</td>
<td align="right">0.591</td>
<td align="right">0.493</td>
<td align="right">0.527</td>
</tr>
<tr class="odd">
<td>disp</td>
<td align="right">0.848</td>
<td align="right">0.902</td>
<td align="right">1.000</td>
<td align="right">0.791</td>
<td align="right">0.710</td>
<td align="right">0.888</td>
<td align="right">0.434</td>
<td align="right">0.556</td>
<td align="right">0.395</td>
</tr>
<tr class="even">
<td>hp</td>
<td align="right">0.776</td>
<td align="right">0.832</td>
<td align="right">0.791</td>
<td align="right">1.000</td>
<td align="right">0.449</td>
<td align="right">0.659</td>
<td align="right">0.708</td>
<td align="right">0.126</td>
<td align="right">0.750</td>
</tr>
<tr class="odd">
<td>drat</td>
<td align="right">0.681</td>
<td align="right">0.700</td>
<td align="right">0.710</td>
<td align="right">0.449</td>
<td align="right">1.000</td>
<td align="right">0.712</td>
<td align="right">0.091</td>
<td align="right">0.700</td>
<td align="right">0.091</td>
</tr>
<tr class="even">
<td>wt</td>
<td align="right">0.868</td>
<td align="right">0.782</td>
<td align="right">0.888</td>
<td align="right">0.659</td>
<td align="right">0.712</td>
<td align="right">1.000</td>
<td align="right">0.175</td>
<td align="right">0.583</td>
<td align="right">0.428</td>
</tr>
<tr class="odd">
<td>qsec</td>
<td align="right">0.419</td>
<td align="right">0.591</td>
<td align="right">0.434</td>
<td align="right">0.708</td>
<td align="right">0.091</td>
<td align="right">0.175</td>
<td align="right">1.000</td>
<td align="right">0.213</td>
<td align="right">0.656</td>
</tr>
<tr class="even">
<td>gear</td>
<td align="right">0.480</td>
<td align="right">0.493</td>
<td align="right">0.556</td>
<td align="right">0.126</td>
<td align="right">0.700</td>
<td align="right">0.583</td>
<td align="right">0.213</td>
<td align="right">1.000</td>
<td align="right">0.274</td>
</tr>
<tr class="odd">
<td>carb</td>
<td align="right">0.551</td>
<td align="right">0.527</td>
<td align="right">0.395</td>
<td align="right">0.750</td>
<td align="right">0.091</td>
<td align="right">0.428</td>
<td align="right">0.656</td>
<td align="right">0.274</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heatmap</span>(<span class="kw">abs</span>(<span class="kw">cor</span>(mtcars2)), <span class="dt">Rowv=</span><span class="ot">NA</span>, <span class="dt">Colv=</span><span class="ot">NA</span>, <span class="dt">revC=</span><span class="ot">TRUE</span>) </code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Podemos observar en el gráfico obtenido la correspondencia entre los colores de los cuadrados y las entradas de la matriz que representa: cuanto más rojo es el cuadrado correspondiente a un par de variables, menor es la entrada de la matriz y por lo tanto menos relación lineal existe entre ellas; y cuanto más claro,
mayor es la entrada de la matriz y por consiguiente su relación lineal. Así, podemos advertir en el gráfico que la variable <code>cyl</code>, el número de cilindros del vehículo, tiene mucha relación lineal con la cilindrada (<code>disp</code>), el consumo (<code>mpg</code>), la potencia (<code>hp</code>), el peso (<code>wt</code>) y la relación del eje trasero (<code>drat</code>); en cambio, la variable <code>qsec</code> (tiempo que tarda el vehículo en recorrer 1/4 de milla) sólo tiene relación lineal con la potencia, <code>hp</code>,
y el número de carburadores, <code>carb</code>.</p>
<p>Antes de continuar, vamos a explicar los parámetros usados en la aplicación anterior de la función <code>heatmap</code>: con <code>Rowv=NA</code> y <code>Colv=NA</code> impedimos que se añadan al gráfico dendrogramas por filas y por columnas, respectivamente (véase la Sección ), y con <code>revC=TRUE</code> hemos indicado que el orden de las variables de izquierda a derecha sea el mismo que de arriba abajo (por defecto, el orden de las filas se invierte).</p>
<p>La función <code>corrplot</code> del paquete homónimo permite producir mapas de calor de matrices de correlaciones más completos:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(corrplot)
<span class="kw">corrplot</span>(<span class="kw">cor</span>(mtcars2))</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>En este caso hemos usado la matriz de correlaciones sin valor absoluto, porque no hace falta: los círculos más grandes indican una mayor correlación en valor absoluto y, por tanto, más relación lineal entre las variables involucradas, y los colores indican el signo de la correlación según el código descrito en la columna de la derecha.
Si además hubiéramos querido que apareciera el valor de la correlación para cada par de variables, hubiéramos podido utilizar las opciones siguientes:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">corrplot</span>(<span class="kw">cor</span>(mtcars2), <span class="dt">method=</span><span class="st">&quot;shade&quot;</span>, <span class="dt">shade.col=</span><span class="ot">NA</span>, 
   <span class="dt">tl.col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">tl.srt=</span><span class="dv">45</span>, <span class="dt">addCoef.col=</span><span class="st">&quot;black&quot;</span>)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-15-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>El significado de los parámetros que hemos usado es el siguiente:
con <code>method=&quot;shade&quot;</code> y <code>shade.col=NA</code> hemos indicado que queremos las celdas coloreadas homogéneamente, en vez de círculos; el parámetro <code>tl.col</code> especifica el color de las etiquetas de las filas y las columnas (por defecto es rojo, como en la anterior aplicación de <code>corrplot</code>); el parámetro <code>tl.srt</code> especifica el ángulo de inclinación de las etiquetas de las columnas en grados (por defecto, son verticales); y con <code>addCoef.col=&quot;black&quot;</code> hemos indicado que incluya los valores de las correlaciones en las casillas, escritos en negro.
Os recomendamos consultar la Ayuda de la función para conocer el resto de parámetros disponibles.</p>

<div class="example">
<span id="exm:VEHICLES" class="example"><strong>Ejemplo 1.2  </strong></span>Ahora vamos a visualizar por medio de un <em>heatmap</em> las diferencias entre los vehículos estudiados en la tabla <code>mtcars</code>. Las diferencias las cuantificaremos por medio de la distancia euclídea entre los vectores que definen las filas de la tabla de datos. Como en el ejemplo anterior, sólo vamos a considerar las variables numéricas, así que usaremos el <em>data frame</em> <code>mtcars2</code>. A modo de ejemplo, las filas de los vehículos <code>Mazda RX4</code> y <code>Valiant</code> son
</div>

<pre class="sourceCode r"><code class="sourceCode r">mtcars2[<span class="kw">c</span>(<span class="st">&quot;Mazda RX4&quot;</span>,<span class="st">&quot;Valiant&quot;</span>),]</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.62</td>
<td align="right">16.46</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>Valiant</td>
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.46</td>
<td align="right">20.22</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>y su distancia euclídea es
<span class="math display">\[
\sqrt{(21-18.1)^2+(6-6)^2+(160-225)^2+(110-105)^2+\cdots +(4-1)^2}=65.4565.
\]</span></p>
<p>Para hallar la matriz de distancias euclídeas entre las filas de la tabla de datos <code>mtcars2</code> usamos la instrucción <code>dist</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">dist.mtcars=<span class="kw">as.matrix</span>(<span class="kw">dist</span>(mtcars2)) 
<span class="kw">round</span>(dist.mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],<span class="dv">2</span>) <span class="co">#Submatriz de las 4 primeras filas y columnas</span></code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Mazda RX4</th>
<th align="right">Mazda RX4 Wag</th>
<th align="right">Datsun 710</th>
<th align="right">Hornet 4 Drive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mazda RX4</td>
<td align="right">0.00</td>
<td align="right">0.62</td>
<td align="right">54.90</td>
<td align="right">98.10</td>
</tr>
<tr class="even">
<td>Mazda RX4 Wag</td>
<td align="right">0.62</td>
<td align="right">0.00</td>
<td align="right">54.88</td>
<td align="right">98.09</td>
</tr>
<tr class="odd">
<td>Datsun 710</td>
<td align="right">54.90</td>
<td align="right">54.88</td>
<td align="right">0.00</td>
<td align="right">150.99</td>
</tr>
<tr class="even">
<td>Hornet 4 Drive</td>
<td align="right">98.10</td>
<td align="right">98.09</td>
<td align="right">150.99</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>La función <code>dist</code> calcula por defecto las distancias euclídeas entre las filas de una matriz o un <em>data frame</em> de variables numéricas. Para calcular alguna otra distancia, se ha de especificar con el parámetro <code>method</code>: consultad la Ayuda de la función para conocer los posibles valores de este parámetro. En el código anterior, hemos usado la función <code>as.matrix</code> para transformar el resultado de <code>dist</code> en una matriz ya que esta última función produce un objeto de clase <code>dist</code> y queremos que el resultado sea una matriz para poderle aplicar la función <code>heatmap</code>.</p>
<p>Dibujemos el <em>heatmap</em> de las distancias entre vehículos:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">heatmap</span>(dist.mtcars, <span class="dt">margins=</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">9</span>), <span class="dt">symm=</span><span class="ot">TRUE</span>, <span class="dt">Rowv=</span><span class="ot">NA</span>, <span class="dt">Colv=</span><span class="ot">NA</span>, <span class="dt">revC=</span><span class="ot">TRUE</span>)  </code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>El parámetro <code>margins</code> especifica el ancho de los márgenes donde se escriben los nombres de las filas y las columnas y lo hemos adaptado para que quepan los nombres de los vehículos;
el parámetro <code>symm=TRUE</code> indica a R que ha de considerar que la matriz es simétrica. El resto de los parámetros ya los hemos explicado antes. Esta función dispone de muchos más parámetros, que podéis consultar en su Ayuda.</p>
<p>La representación visual tiene el mismo significado que antes, pero referida a la matriz a la que hemos aplicado la función <code>heatmap</code>: cuanto más roja es la casilla, menor es la distancia entre los vehículos, y por lo tanto más parecidos son.
Así, por ejemplo, si observamos la columna del vehículo <code>Mazda RX4</code>, vemos que los vehículos más diferentes a él son <code>Cadillac Fleetwood</code>, <code>Lincoln Continental</code> y <code>Chrysler Imperial</code>, ya que aparecen con un color más cercano al blanco, y los más parecidos son <code>Mazda RX4 Wag</code>, <code>Merc 280</code>, <code>Merc 280C</code>, <code>Merc 230</code>, <code>Volvo 142E</code>, <code>Toyota Corona</code>,
<code>Porsche 914-2</code>, <code>Merc 240D</code>, etc.</p>
</div>
<div id="dendrogramas" class="section level2">
<h2><span class="header-section-number">1.3</span> Dendrogramas</h2>
<p>Dada una tabla de datos podemos construir una matriz de distancias entre los individuos representados en ella, aplicando una distancia concreta a cada par de filas; es lo que hicimos en el Ejemplo <a href="graficos-avanzados.html#exm:VEHICLES">1.2</a>, donde calculamos la distancia euclídea entre cada par de descripciones de tipo de coche.
Una vez construida dicha matriz de distancias, podemos ir agrupando los individuos de la tabla de datos usando algún algoritmo de <em>agrupamiento</em>, o <em>clustering</em> jerárquico.</p>
<p>Muchos algoritmos de <em>clustering</em> jerárquico siguen una misma estrategia. En un primer paso, se agrupan los dos individuos más parecidos (más cercanos según la distancia usada) en un grupo y se los sustituye por este grupo, al que se considera un nuevo individuo <em>virtual</em>. A partir de aquí, en cada paso, se agrupan en un nuevo grupo los dos individuos (originales o <em>virtuales</em>) más cercanos y se los sustituye por el grupo que forman. El algoritmo termina cuando queda un único grupo. Los diferentes algoritmos de este tipo, denominados genéricamente <em>aglomerativos</em>, se distinguen básicamente según la manera como se define la distancia entre grupos a partir de las distancias entre sus individuos; aquí no entraremos en detalle y nos limitaremos a usar el algoritmo que lleva implementado R por defecto (el llamado <em>método de enlace completo</em>: la distancia entre dos grupos es el máximo de las distancias entre sus elementos). <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>Un <em>dendrograma</em> es entonces una representación gráfica del orden en el que se han ido realizando dichas agrupaciones y de las distancias entre los pares de individuos (originales y <em>virtuales</em>) que se han ido uniendo. Así podemos visualizar qué individuos se parecen más o si aparece de manera natural alguna clasificación de los individuos.</p>
<p>Veamos un ejemplo detallado.
La tabla de datos <code>all.mammals.milk.1956</code> que lleva el paquete <code>cluster.datasets</code> contiene información sobre 5 variables numéricas relativas a la composición de la leche materna de 25 especies de mamíferos. Las variables de esta tabla de datos son:</p>
<ul>
<li><code>name</code>: El nombre del animal.</li>
<li><code>water</code>: Porcentaje de agua en la leche.</li>
<li><code>protein</code>: Porcentaje de proteína.</li>
<li><code>fat</code>: Porcentaje de grasa.</li>
<li><code>lactose</code>: Porcentaje de lactosa.</li>
<li><code>ash</code>: Porcentaje de ceniza.</li>
</ul>
<p>Démosle un vistazo.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cluster.datasets)
<span class="kw">data</span>(all.mammals.milk<span class="fl">.1956</span>)  
AMM=all.mammals.milk<span class="fl">.1956</span>
<span class="kw">str</span>(AMM)</code></pre>
<pre><code>## &#39;data.frame&#39;:    25 obs. of  6 variables:
##  $ name   : chr  &quot;Horse&quot; &quot;Orangutan&quot; &quot;Monkey&quot; &quot;Donkey&quot; ...
##  $ water  : num  90.1 88.5 88.4 90.3 90.4 87.7 86.9 82.1 81.9 81.6 ...
##  $ protein: num  2.6 1.4 2.2 1.7 0.6 3.5 4.8 5.9 7.4 10.1 ...
##  $ fat    : num  1 3.5 2.7 1.4 4.5 3.4 1.7 7.9 7.2 6.3 ...
##  $ lactose: num  6.9 6 6.4 6.2 4.4 4.8 5.7 4.7 2.7 4.4 ...
##  $ ash    : num  0.35 0.24 0.18 0.4 0.1 0.71 0.9 0.78 0.85 0.75 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(AMM)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">water</th>
<th align="right">protein</th>
<th align="right">fat</th>
<th align="right">lactose</th>
<th align="right">ash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Horse</td>
<td align="right">90.1</td>
<td align="right">2.6</td>
<td align="right">1.0</td>
<td align="right">6.9</td>
<td align="right">0.35</td>
</tr>
<tr class="even">
<td align="left">Orangutan</td>
<td align="right">88.5</td>
<td align="right">1.4</td>
<td align="right">3.5</td>
<td align="right">6.0</td>
<td align="right">0.24</td>
</tr>
<tr class="odd">
<td align="left">Monkey</td>
<td align="right">88.4</td>
<td align="right">2.2</td>
<td align="right">2.7</td>
<td align="right">6.4</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">Donkey</td>
<td align="right">90.3</td>
<td align="right">1.7</td>
<td align="right">1.4</td>
<td align="right">6.2</td>
<td align="right">0.40</td>
</tr>
<tr class="odd">
<td align="left">Hippo</td>
<td align="right">90.4</td>
<td align="right">0.6</td>
<td align="right">4.5</td>
<td align="right">4.4</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="left">Camel</td>
<td align="right">87.7</td>
<td align="right">3.5</td>
<td align="right">3.4</td>
<td align="right">4.8</td>
<td align="right">0.71</td>
</tr>
</tbody>
</table>
<p>Para cuantificar la diferencia entre las composiciones de la leche de estos mamíferos, usaremos de nuevo la distancia euclídea entre sus vectores de valores de variables numéricas.</p>
<pre class="sourceCode r"><code class="sourceCode r">dist.AMM=<span class="kw">dist</span>(AMM[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>])
<span class="kw">round</span>(<span class="kw">as.matrix</span>(dist.AMM)[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>],<span class="dv">3</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.000</td>
<td align="right">3.327</td>
<td align="right">2.494</td>
<td align="right">1.226</td>
<td align="right">4.759</td>
<td align="right">4.107</td>
</tr>
<tr class="even">
<td align="right">3.327</td>
<td align="right">0.000</td>
<td align="right">1.206</td>
<td align="right">2.794</td>
<td align="right">2.798</td>
<td align="right">2.592</td>
</tr>
<tr class="odd">
<td align="right">2.494</td>
<td align="right">1.206</td>
<td align="right">0.000</td>
<td align="right">2.375</td>
<td align="right">3.716</td>
<td align="right">2.348</td>
</tr>
<tr class="even">
<td align="right">1.226</td>
<td align="right">2.794</td>
<td align="right">2.375</td>
<td align="right">0.000</td>
<td align="right">3.763</td>
<td align="right">4.007</td>
</tr>
<tr class="odd">
<td align="right">4.759</td>
<td align="right">2.798</td>
<td align="right">3.716</td>
<td align="right">3.763</td>
<td align="right">0.000</td>
<td align="right">4.176</td>
</tr>
<tr class="even">
<td align="right">4.107</td>
<td align="right">2.592</td>
<td align="right">2.348</td>
<td align="right">4.007</td>
<td align="right">4.176</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<p>Hemos transformado el objeto <code>dist</code> en una matriz para poder consultar algunas entradas, pero lo mantenemos como objeto de tipo <code>dist</code> para construir su dendrograma.</p>
<p>Una vez se dispone de la matriz de distancias entre los individuos (en este caso, mamíferos), se calcula su <em>clustering</em> jerárquico aplicándole la función <code>hclust</code> y se convierte el resultado de esta función en un dendrograma usando <code>as.dendrogram</code>.
La función <code>hclust</code> permite especificar el tipo de algoritmo de agrupamiento que queremos usar por medio del parámetro <code>method</code>; aquí usaremos el método por defecto.</p>
<pre class="sourceCode r"><code class="sourceCode r">dend.AMM=<span class="kw">as.dendrogram</span>(<span class="kw">hclust</span>(dist.AMM))</code></pre>
<p>Y ahora ya podemos dibujar este dendrograma. Hay muchas opciones para hacerlo con R. La básica es aplicarle simplemente la función <code>plot</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(dend.AMM)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-22-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>En este gráfico, los grupos se representan mediante líneas horizontales y las alturas representan distancias, de manera que la altura a la que se unen dos grupos es la distancia entre ellos. Así, este dendrograma nos muestra, por ejemplo, que la composición de la leche de los animales 24 y 25 (foca y delfín) es diferente de la del resto, formando un grupo propio que no se ha unido al resto de animales hasta el último paso. En cambio, la ballena (el 23), que comparte hábitat y dieta con ellos, se agrupa con el ciervo y el reno (21 y 22).
Por otro lado, cortando por una línea horizontal imaginaria a altura 30, podemos observar que se forman tres grupos muy claros.</p>
<p>En un dendrograma producido a partir de las distancias entre las filas de un <em>data frame</em>, los individuos se representan mediante los identificadores de las filas: en nuestro ejemplo, números. Si queremos los nombres de los animales como etiquetas, una posibilidad es modificar el <em>data frame</em> <code>AMM</code> usando como identificadores de las filas los nombres de los animales; y ya que estamos, podemos eliminar esta variable del <em>data frame</em> resultante:</p>
<pre class="sourceCode r"><code class="sourceCode r">AMM.nombres=AMM
<span class="kw">rownames</span>(AMM.nombres)=AMM.nombres<span class="op">$</span>name
AMM.nombres=AMM.nombres[,<span class="op">-</span><span class="dv">1</span>]
<span class="kw">head</span>(AMM.nombres)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">water</th>
<th align="right">protein</th>
<th align="right">fat</th>
<th align="right">lactose</th>
<th align="right">ash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Horse</td>
<td align="right">90.1</td>
<td align="right">2.6</td>
<td align="right">1.0</td>
<td align="right">6.9</td>
<td align="right">0.35</td>
</tr>
<tr class="even">
<td>Orangutan</td>
<td align="right">88.5</td>
<td align="right">1.4</td>
<td align="right">3.5</td>
<td align="right">6.0</td>
<td align="right">0.24</td>
</tr>
<tr class="odd">
<td>Monkey</td>
<td align="right">88.4</td>
<td align="right">2.2</td>
<td align="right">2.7</td>
<td align="right">6.4</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td>Donkey</td>
<td align="right">90.3</td>
<td align="right">1.7</td>
<td align="right">1.4</td>
<td align="right">6.2</td>
<td align="right">0.40</td>
</tr>
<tr class="odd">
<td>Hippo</td>
<td align="right">90.4</td>
<td align="right">0.6</td>
<td align="right">4.5</td>
<td align="right">4.4</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td>Camel</td>
<td align="right">87.7</td>
<td align="right">3.5</td>
<td align="right">3.4</td>
<td align="right">4.8</td>
<td align="right">0.71</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">as.dendrogram</span>(<span class="kw">hclust</span>(<span class="kw">dist</span>(AMM.nombres))))</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>En el gráfico anterior podemos leer (más o menos) los nombres de los animales sin tener que ir a consultar el <em>data frame</em>.</p>
<p>Aparte de los parámetros usuales de la función <code>plot</code>, dos parámetros interesantes cuando se aplica a un dendrograma son <code>horiz=TRUE</code>, que lo dibuja horizontal, y <code>type=&quot;triangle&quot;</code>, que dibuja las ramificaciones triangulares en vez de rectangulares.</p>
<p>Para tener más control sobre el aspecto de un dendrograma, por ejemplo cambiar sus etiquetas sin modificar el <em>data frame</em> original, escribirlas en un tamaño menor o mayor o colorear ramas o etiquetas a fin de añadir información al dendrograma, lo más sencillo es utilizar algunas funciones específicas aportadas por diversos paquetes. Aquí vamos a explicar algunas funcionalidades del paquete <code>dendextend</code>.</p>
<p>A modo de ejemplo, una vez cargado este paquete, para cambiar directamente las etiquetas del dendrograma del <em>data frame</em> <code>AMM</code>, podemos usar de manera natural la función <code>labels</code>, que nos da las etiquetas de las hojas.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dendextend)
L=<span class="kw">labels</span>(dend.AMM)
L</code></pre>
<pre><code>##  [1] 24 25 10  8 11 16  9 14  7 15  6 12  5  2  3  1  4 13 17 19 20 18 23
## [24] 21 22</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">labels</span>(dend.AMM)=AMM<span class="op">$</span>name[L]
<span class="kw">labels</span>(dend.AMM)</code></pre>
<pre><code>##  [1] &quot;Seal&quot;       &quot;Dolphin&quot;    &quot;Cat&quot;        &quot;Buffalo&quot;    &quot;Fox&quot;       
##  [6] &quot;Sheep&quot;      &quot;Guinea Pig&quot; &quot;Pig&quot;        &quot;Bison&quot;      &quot;Zebra&quot;     
## [11] &quot;Camel&quot;      &quot;Llama&quot;      &quot;Hippo&quot;      &quot;Orangutan&quot;  &quot;Monkey&quot;    
## [16] &quot;Horse&quot;      &quot;Donkey&quot;     &quot;Mule&quot;       &quot;Dog&quot;        &quot;Rabbit&quot;    
## [21] &quot;Rat&quot;        &quot;Elephant&quot;   &quot;Whale&quot;      &quot;Deer&quot;       &quot;Reindeer&quot;</code></pre>
<p>La función <code>labels</code> aplicada a un dendrograma nos da las etiquetas de las hojas de izquierda a derecha, y con el paquete <code>dendextend</code> nos permite también modificar estas etiquetas. Naturalmente, a cada etiqueta (en nuestro ejemplo, número de fila) le tenemos que hacer corresponder el nombre del animal que le toca: por eso usamos <code>labels(dend.AMM)=AMM$name[L]</code> y no <code>labels(dend.AMM)=AMM$name</code> a secas, que a la primera etiqueta del dendrograma (la 25) le asignaría el primer nombre de animal, correspondiente a la etiqueta 1.</p>
<p>Ahora que ya hemos modificado las etiquetas del dendrograma, podemos modificar su apariencia de cara a representarlo gráficamente. Para ello podemos usar la función <code>set</code>, cuya sintaxis básica es</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set</span>(dendrograma, <span class="dt">what=</span><span class="st">&quot;característica&quot;</span>, valor)</code></pre>
<p>Encontraréis la lista completa de las características que podemos usar en la Ayuda de la función.
Pero cuidado, <code>set</code> no modifica el dendrograma permanentemente, solo temporalmente. Si queréis modificar el dendrograma, tenéis que usar</p>
<pre class="sourceCode r"><code class="sourceCode r">dendrograma =<span class="kw">set</span>(dendrograma, <span class="dt">what=</span><span class="st">&quot;característica&quot;</span>, valor)</code></pre>
<p>Si queremos cambiar más de una característica de golpe, es muy cómodo usar la notación <em>encadenada</em> de funciones, en la que a un objeto se le van aplicando funciones una tras otra separándolas con el signo <code>&gt;</code>. <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
En este caso, no se entra el dendrograma dentro de <code>set</code>, sino al principio de la cadena.
Por ejemplo, para reducir el tamaño de letra de las etiquetas (para que así quepan en el gráfico) y escribirlas en rojo, podemos entrar el código siguiente:</p>
<pre class="sourceCode r"><code class="sourceCode r">dend.AMM<span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_col&quot;</span>, <span class="st">&quot;red&quot;</span>)<span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Colores de las etiquetas</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_cex&quot;</span>, <span class="fl">0.8</span>)<span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Tamaño de las etiquetas</span>
<span class="st">   </span><span class="kw">plot</span>(<span class="dt">main=</span><span class="st">&quot;Dendrograma con etiquetas coloreadas</span><span class="ch">\n</span><span class="st"> y reducidas&quot;</span>)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Observad la sintaxis: se toma el objeto <code>dend.AMM</code>, se le aplican las dos transformaciones, una tras otra, y al final se le aplica <code>plot</code> con los parámetros que deseemos.
No hemos modificado el dendrograma <code>dend.AMM</code>, solo su apariencia en el gráfico.</p>
<p>La posibilidad de colorear las etiquetas, o las aristas, puede mejorar la comprensión del dendrograma, o incluso añadir información. Veamos dos aplicaciones:</p>
<ul>
<li>Para distinguir visualmente los principales grupos que se forman en el dendrograma, y por ejemplo usar un color en cada grupo, podemos usar el parámetro <code>k</code> igualado al número de grupos que queremos reconocer.
Por ejemplo,</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">dend.AMM<span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_cex&quot;</span>, <span class="fl">0.8</span>)<span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_col&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>), <span class="dt">k=</span><span class="dv">3</span>)<span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;branches_k_color&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>),<span class="dt">k=</span><span class="dv">3</span>)<span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Colores de las ramas</span>
<span class="st">   </span><span class="kw">plot</span>(<span class="dt">main=</span><span class="st">&quot;Dendrograma con 3 grupos resaltados&quot;</span>)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-28-1.png" width="480" style="display: block; margin: auto;" /></p>
<ul>
<li>Podemos clasificar los individuos representados en el dendrograma mediante un factor
y usar este factor para asignar colores a las etiquetas para así ver si los grupos que produce el dendrograma se corresponden con la clasificación según el factor. Como nuestro <em>data frame</em> <code>AMM</code> no tiene ninguna variable factor que podamos usar, vamos a añadirle una que represente la dieta principal del animal: C para carnívoro, H para herbívoro, O para omnívoro, P para piscívoro.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">AMM<span class="op">$</span>diet=<span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="st">&quot;H&quot;</span>,<span class="st">&quot;O&quot;</span>,<span class="st">&quot;O&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,
   <span class="st">&quot;C&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;O&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;O&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;P&quot;</span>,
   <span class="st">&quot;P&quot;</span>,<span class="st">&quot;P&quot;</span>))
<span class="kw">head</span>(AMM)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">water</th>
<th align="right">protein</th>
<th align="right">fat</th>
<th align="right">lactose</th>
<th align="right">ash</th>
<th align="left">diet</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Horse</td>
<td align="right">90.1</td>
<td align="right">2.6</td>
<td align="right">1.0</td>
<td align="right">6.9</td>
<td align="right">0.35</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">Orangutan</td>
<td align="right">88.5</td>
<td align="right">1.4</td>
<td align="right">3.5</td>
<td align="right">6.0</td>
<td align="right">0.24</td>
<td align="left">O</td>
</tr>
<tr class="odd">
<td align="left">Monkey</td>
<td align="right">88.4</td>
<td align="right">2.2</td>
<td align="right">2.7</td>
<td align="right">6.4</td>
<td align="right">0.18</td>
<td align="left">O</td>
</tr>
<tr class="even">
<td align="left">Donkey</td>
<td align="right">90.3</td>
<td align="right">1.7</td>
<td align="right">1.4</td>
<td align="right">6.2</td>
<td align="right">0.40</td>
<td align="left">H</td>
</tr>
<tr class="odd">
<td align="left">Hippo</td>
<td align="right">90.4</td>
<td align="right">0.6</td>
<td align="right">4.5</td>
<td align="right">4.4</td>
<td align="right">0.10</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">Camel</td>
<td align="right">87.7</td>
<td align="right">3.5</td>
<td align="right">3.4</td>
<td align="right">4.8</td>
<td align="right">0.71</td>
<td align="left">H</td>
</tr>
</tbody>
</table>
<p>Ahora colorearemos las etiquetas del dendrograma según su dieta, y aprovecharemos para ver otra manera de usar <code>set</code>, definiendo un nuevo dendrograma <code>dend.AMM2</code> donde los cambios realizados sobre <code>dend.AMM</code> por las diferentes aplicaciones de <code>set</code> sean permanentes.</p>
<pre class="sourceCode r"><code class="sourceCode r">dend.AMM2=dend.AMM<span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_cex&quot;</span>, <span class="fl">0.8</span>)<span class="op">%&gt;%</span><span class="st">   </span><span class="co">#Tamaño de etiquetas</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels&quot;</span>,AMM<span class="op">$</span>name[L])<span class="op">%&gt;%</span><span class="st">  </span><span class="co">#Nombres en las etiquetas</span>
<span class="st">   </span><span class="kw">set</span>(<span class="dt">what=</span><span class="st">&quot;labels_col&quot;</span>,<span class="kw">as.numeric</span>(AMM<span class="op">$</span>diet[L]))  <span class="co">#Colores según la dieta</span>
<span class="kw">plot</span>(dend.AMM2, <span class="dt">main=</span><span class="st">&quot;Dendrograma de mamíferos clasificados</span>
<span class="st">    </span><span class="ch">\n</span><span class="st"> según la dieta&quot;</span>)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Vemos que la similitud de la composición de la leche materna no tiene mucha correspondencia con la dieta.</p>
<p>Para más información sobre las posibilidades de <code>dendextend</code> y su interacción con otros paquetes que dibujan dendrogramas, consultad <a href="https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html">https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html</a>. Por ejemplo,
podemos modificar un dendrograma con <code>set</code> y luego
aplicarle la función <code>circlize_dendrogram</code> del paquete <code>circlize</code> para obtener una representación circular. Véase el gráfico siguiente:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(circlize)
<span class="kw">circlize_dendrogram</span>(dend.AMM2)</code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-31-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="graficos-de-burbujas-o-bubbles" class="section level2">
<h2><span class="header-section-number">1.4</span> Gráficos de burbujas o <em>bubbles</em></h2>
<p>Hay situaciones en las que nos interesa resaltar la importancia de una variable dibujando figuras geométricas (círculos, cuadrados, etc.) de tamaño proporcional a la importancia del valor de la variable. Este tipo de gráficos se
denominan <em>gráficos de burbujas</em>, o <em>bubbles</em>, y la función básica para producirlos es <code>symbols</code>. Su sintáxis básica es</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">symbols</span>(x, y, <span class="st">&quot;parámetro_figura&quot;</span> =z, ...)</code></pre>
<p>donde <code>x</code> e <code>y</code> son los vectores de primeras y segundas coordenadas de los centros de las figuras a dibujar, el
<em>parámetro_figura</em> indica el tipo de figuras (<code>circles</code> para círculos, <code>squares</code> para cuadrados, <code>stars</code> para estrellas, etc.), y <code>z</code> es el vector de los tamaños <em>lineales</em> de las figuras: radio para los círculos, lado para los cuadrados, longitud del rayo para las estrellas, etc. Además se pueden usar los dos parámetros siguientes para añadir colores a las figuras:</p>
<ul>
<li><code>fg</code>: el color de la frontera de los símbolos (por defecto, negro).</li>
<li><code>bg</code>: su color de relleno.</li>
</ul>
<p>Y finalmente, se pueden usar los parámetros usuales de <code>plot</code>; para más información, incluida la lista de figuras disponibles, consultad la Ayuda de la función.</p>
<p>Veamos un ejemplo. Consideremos la tabla de datos <code>savings</code> que lleva el paquete <code>faraway</code>. Dicha tabla de datos nos da los 5 indicadores económicos siguientes de 50 países durante el período 1960–1970:</p>
<ul>
<li><code>sr</code>: la tasa de ahorro, <em>savings rate</em>, de cada país.</li>
<li><code>pop15</code>: su porcentaje de población menor de 15 años.</li>
<li><code>pop75</code>: su porcentaje de población mayor de 75 años.</li>
<li><code>dpi</code>: su renta per cápita en dólares.</li>
<li><code>ddpi</code>: su tasa de crecimiento como porcentaje de su renta per cápita.</li>
</ul>
<p>Vamos a producir un gráfico de burbujas de la tasa de ahorro de cada país en función de su renta per cápita, donde la
variable <em>burbuja</em> será la tasa de crecimiento; es decir, para cada país, dibujaremos una burbuja centrada en el punto de coordenadas (renta per cápita, tasa de ahorro) de diámetro proporcional a su tasa de crecimiento.
Además, colorearemos las burbujas según una escala de colores ocres que represente el porcentaje de la población menor de 15 años: cuanto más oscura sea la burbuja, mayor es dicho porcentaje. El código para producir el gráfico, tras cargar los paquetes <code>faraway</code> (para tener acceso a los datos) y <code>RColorBrewer</code> (para poder definir la paleta de colores), es el siguiente:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(faraway)
<span class="kw">library</span>(RColorBrewer)
<span class="co">#Agrupamos los porcentajes de población menor de 15 años en 9 grupos</span>
porcentajes15=<span class="kw">as.numeric</span>(<span class="kw">cut</span>(savings<span class="op">$</span>pop15, <span class="dv">9</span>)) 
<span class="co">#Definimos nuestra paleta en función de los valores de la variable anterior</span>
colores=<span class="kw">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;YlOrBr&quot;</span>)[porcentajes15]
<span class="co">#Dibujamos el gráfico de burbujas</span>
<span class="kw">symbols</span>(savings<span class="op">$</span>dpi, savings<span class="op">$</span>sr, <span class="dt">circles=</span>savings<span class="op">$</span>ddpi, 
   <span class="dt">bg=</span>colores, <span class="dt">xlab=</span><span class="st">&quot;Renta per cápita&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Tasa de ahorro&quot;</span>) 
<span class="co">#Escribimos el nombre de cada país en el centro de su burbuja       </span>
<span class="kw">text</span>(savings<span class="op">$</span>dpi,savings<span class="op">$</span>sr, <span class="kw">rownames</span>(savings), <span class="dt">cex=</span><span class="fl">0.75</span>) </code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-33-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>A simple vista se puede observar, por ejemplo, que los Estados Unidos tienen la renta per cápita más alta, una tasa de ahorro entre moderada y baja, una tasa de crecimiento de la renta per cápita baja y un porcentaje de población menor de 15 años también bajo; en cambio, Japón tiene una renta per cápita más baja, una tasa de ahorro y una tasa de crecimiento de la renta per cápita mucho más altas pero la población menor de 15 años sigue siendo baja. También se observa que, en general, el porcentaje de población menor de 15 años en los países más desarrollados es mucho menor que en los países menos desarrollados.</p>
<p>Este tipo de gráficos, tal cual los produce R, tienen un defecto: como los tamaños de las burbujas se indican por medio de una dimensión lineal, su área crece con el cuadrado de dicha dimensión; por ejemplo,
en nuestro gráfico, la burbuja de un país con el doble de tasa de crecimiento que otro tiene un área cuatro veces mayor que la de este otro país. Como, instintivamente, comparamos áreas y no diámetros,
esto puede llevar a confusión. La solución es sencilla: si queremos que las proporcionales a las tasas de crecimiento sean las áreas de los círculos, cuadrados, rectángulos, etc., y no sus amplitudes,
basta entrar como dimensiones de las figuras sus raíces cuadradas. Así, el código siguiente produce un gráfico que, para nuestro gusto, representa mejor los datos.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">symbols</span>(savings<span class="op">$</span>dpi, savings<span class="op">$</span>sr, <span class="dt">circles=</span><span class="kw">sqrt</span>(savings<span class="op">$</span>ddpi), 
   <span class="dt">bg=</span>colores, <span class="dt">xlab=</span><span class="st">&quot;Renta per cápita&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Tasa de ahorro&quot;</span>) 
<span class="kw">text</span>(savings<span class="op">$</span>dpi,savings<span class="op">$</span>sr, <span class="kw">rownames</span>(savings), <span class="dt">cex=</span><span class="fl">0.75</span>) </code></pre>
<p><img src="AprendeR-Parte-II_files/figure-html/unnamed-chunk-34-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="graficos-de-corrientes-o-streamgraphs" class="section level2">
<h2><span class="header-section-number">1.5</span> Gráficos de corrientes o <em>streamgraphs</em></h2>
<p>En los últimos 10 años se han puesto de moda un tipo de gráficos que sirven para visualizar cómo diversas cantidades varían conjuntamente a lo largo del tiempo: son los llamados <em>gráficos de corrientes</em>, o <em>streamgraphs</em>. Con R este tipo de gráficos se producen fácilmente con el paquete <code>streamgraph</code>, que aún no está disponible en el servidor de la CRAN, <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> pero puede instalarse desde <em>GitHub</em>. Para ello no podemos emplear el instalador de paquetes de <code>RStudio</code> ni la función <code>install.packages</code>, sino la función específica <code>install_github</code> del paquete <code>devtools</code>, aplicado al <em>url</em> del paquete (que tenemos que conocer). Así, para instalar y cargar el paquete <code>streamgraph</code>, a día de hoy hay que ejecutar el código siguiente:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;hrbrmstr/streamgraph&quot;</span>,<span class="dt">force=</span><span class="ot">TRUE</span>)
<span class="kw">library</span>(streamgraph)</code></pre>
<p>Ahora que ya lo tenemos cargado, vamos a producir un <em>streamgraph</em> de los diferentes géneros de películas desde los años 30 hasta la actualidad. Para ello, usaremos la tabla de datos <code>movies</code>, con información de 58,788 películas, que lleva el paquete <code>ggplot2movies</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2movies)
<span class="kw">data</span>(movies)
<span class="kw">str</span>(movies)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    58788 obs. of  24 variables:
##  $ title      : chr  &quot;$&quot; &quot;$1000 a Touchdown&quot; &quot;$21 a Day Once a Month&quot; &quot;$40,000&quot; ...
##  $ year       : int  1971 1939 1941 1996 1975 2000 2002 2002 1987 1917 ...
##  $ length     : int  121 71 7 70 71 91 93 25 97 61 ...
##  $ budget     : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ rating     : num  6.4 6 8.2 8.2 3.4 4.3 5.3 6.7 6.6 6 ...
##  $ votes      : int  348 20 5 6 17 45 200 24 18 51 ...
##  $ r1         : num  4.5 0 0 14.5 24.5 4.5 4.5 4.5 4.5 4.5 ...
##  $ r2         : num  4.5 14.5 0 0 4.5 4.5 0 4.5 4.5 0 ...
##  $ r3         : num  4.5 4.5 0 0 0 4.5 4.5 4.5 4.5 4.5 ...
##  $ r4         : num  4.5 24.5 0 0 14.5 14.5 4.5 4.5 0 4.5 ...
##  $ r5         : num  14.5 14.5 0 0 14.5 14.5 24.5 4.5 0 4.5 ...
##  $ r6         : num  24.5 14.5 24.5 0 4.5 14.5 24.5 14.5 0 44.5 ...
##  $ r7         : num  24.5 14.5 0 0 0 4.5 14.5 14.5 34.5 14.5 ...
##  $ r8         : num  14.5 4.5 44.5 0 0 4.5 4.5 14.5 14.5 4.5 ...
##  $ r9         : num  4.5 4.5 24.5 34.5 0 14.5 4.5 4.5 4.5 4.5 ...
##  $ r10        : num  4.5 14.5 24.5 45.5 24.5 14.5 14.5 14.5 24.5 4.5 ...
##  $ mpaa       : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ Action     : int  0 0 0 0 0 0 1 0 0 0 ...
##  $ Animation  : int  0 0 1 0 0 0 0 0 0 0 ...
##  $ Comedy     : int  1 1 0 1 0 0 0 0 0 0 ...
##  $ Drama      : int  1 0 0 0 0 1 1 0 1 0 ...
##  $ Documentary: int  0 0 0 0 0 0 0 1 0 0 ...
##  $ Romance    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Short      : int  0 0 1 0 0 0 0 1 0 0 ...</code></pre>
<p>De esta tabla de datos nos vamos a quedar solo con las variables <code>year</code> (año de estreno) y
<code>Action</code>, <code>Animation</code>, <code>Comedy</code>, <code>Drama</code>, <code>Documentary</code>, <code>Romance</code> y <code>Short</code>, variables binarias que indican si la película entra o no en cada una de las categorías siguientes: acción, animación, comedia, drama, documental, romántica y cortometraje, respectivamente.</p>
<pre class="sourceCode r"><code class="sourceCode r">movies.small=movies[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">18</span><span class="op">:</span><span class="dv">24</span>)]
<span class="kw">str</span>(movies.small)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    58788 obs. of  8 variables:
##  $ year       : int  1971 1939 1941 1996 1975 2000 2002 2002 1987 1917 ...
##  $ Action     : int  0 0 0 0 0 0 1 0 0 0 ...
##  $ Animation  : int  0 0 1 0 0 0 0 0 0 0 ...
##  $ Comedy     : int  1 1 0 1 0 0 0 0 0 0 ...
##  $ Drama      : int  1 0 0 0 0 1 1 0 1 0 ...
##  $ Documentary: int  0 0 0 0 0 0 0 1 0 0 ...
##  $ Romance    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Short      : int  0 0 1 0 0 0 0 1 0 0 ...</code></pre>
<p>Ahora hemos de modificar el <em>data frame</em> para poderlo usar como una serie temporal, donde para cada año y para cada categoría nos dé el correspondiente número de películas. La manera más sencilla es, en primer lugar, usar la función <code>gather</code> del paquete <code>tidyr</code>, especializado en funciones para <em>limpiar</em> y reorganizar datos.
Con esta función podemos sustituir las variables binarias correspondientes a las categorías por
una nueva variable factor (la llamaremos <code>genero</code>) cuyos valores sean los nombres de dichas variables y añadir una nueva variable binaria (la llamaremos <code>valor</code>) que da el valor de la variable binaria original.
La sintaxis es</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(<span class="st">&quot;dataframe&quot;</span>, <span class="st">&quot;nuevo factor&quot;</span>, <span class="st">&quot;nueva variable numérica&quot;</span>, <span class="st">&quot;variables agrupadas&quot;</span>)</code></pre>
<p>De esta manera, en nuestro caso, cada fila de <code>movies.small</code> se convierte en 7 filas del nuevo <em>data frame</em>, una para cada variable <em>agrupada</em> en la nueva variable <code>genero</code>. A continuación, observamos que menos del 0.1% de las películas se filmaron antes de 1930, por lo que en nuestro <em>streamgraph</em> esos años van a aparecer muy delgados, así que los eliminamos.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
movies.agrup=<span class="kw">gather</span>(movies.small,genero,valor,<span class="op">-</span>year) <span class="co">#-year indica &quot;todas las variables menos year&quot;</span>
<span class="kw">str</span>(movies.agrup)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    411516 obs. of  3 variables:
##  $ year  : int  1971 1939 1941 1996 1975 2000 2002 2002 1987 1917 ...
##  $ genero: chr  &quot;Action&quot; &quot;Action&quot; &quot;Action&quot; &quot;Action&quot; ...
##  $ valor : int  0 0 0 0 0 0 1 0 0 0 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(movies.agrup<span class="op">$</span>year,<span class="fl">0.001</span>)</code></pre>
<pre><code>## 0.1% 
## 1900</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">movies.agrup=movies.agrup[movies.agrup<span class="op">$</span>year<span class="op">&gt;=</span><span class="dv">1930</span>,]</code></pre>
<p>A continuación, para cada año y cada categoría, sumamos los valores de la variable <code>valor</code>: como son ceros y unos, esto nos dará, los números anuales de películas de cada categoría. Una posible manera de hacerlo es con el código siguiente (la suma de dos factores indica que agrupamos los datos por todas la combinaciones de un nivel de cada factor):</p>
<pre class="sourceCode r"><code class="sourceCode r">sum.movies.agrup=<span class="kw">aggregate</span>(valor<span class="op">~</span>year<span class="op">+</span>genero, <span class="dt">data=</span>movies.agrup,
   <span class="dt">FUN=</span>sum)
<span class="kw">str</span>(sum.movies.agrup)</code></pre>
<pre><code>## &#39;data.frame&#39;:    532 obs. of  3 variables:
##  $ year  : int  1930 1931 1932 1933 1934 1935 1936 1937 1938 1939 ...
##  $ genero: chr  &quot;Action&quot; &quot;Action&quot; &quot;Action&quot; &quot;Action&quot; ...
##  $ valor : int  4 5 5 6 8 17 9 14 8 17 ...</code></pre>
<p>Y ahora ya estamos en disposición de dibujar el <em>streamgraph</em>. La función para hacerlo es</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">streamgraph</span>(data frame, <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;valores&quot;</span>, <span class="st">&quot;tiempo&quot;</span>, <span class="dt">interactive=</span>...)? </code></pre>
<p>donde especificamos el <em>factor</em> del <em>data frame</em> de cuyas variables queremos representar sus <em>valores</em> a lo largo del <em>tiempo</em>. El parámetro <code>interactive</code> es muy interesante, pero por ahora lo declararemos como <code>FALSE</code>, puesto que vamos a producir un dibujo para incorporar a este documento.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">streamgraph</span>(sum.movies.agrup, <span class="st">&quot;genero&quot;</span>, <span class="st">&quot;valor&quot;</span>, <span class="st">&quot;year&quot;</span>,
   <span class="dt">interactive=</span><span class="ot">FALSE</span>)</code></pre>
<div id="htmlwidget-e7301477d6b901f43b8a" class="streamgraph html-widget" style="width:480px;height:480px;"></div>
<div id="htmlwidget-e7301477d6b901f43b8a-legend" style="width:480" class="streamgraph html-widget-legend"><center><label style='padding-right:5px' for='htmlwidget-e7301477d6b901f43b8a-select'></label><select id='htmlwidget-e7301477d6b901f43b8a-select' style='visibility:hidden;'></select></center></div>
<script type="application/json" data-for="htmlwidget-e7301477d6b901f43b8a">{"x":{"data":{"key":["Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short"],"value":[4,26,125,7,106,53,74,5,41,146,5,138,45,91,5,63,143,6,157,33,116,6,51,159,7,167,66,107,8,49,192,7,164,61,123,17,69,192,13,140,62,122,9,85,212,4,120,47,143,14,75,209,10,153,62,127,8,76,217,11,133,53,126,17,80,183,10,179,35,127,15,85,213,16,156,45,134,16,97,242,16,139,57,141,24,100,203,19,148,40,145,18,74,165,26,129,26,123,11,68,157,14,118,32,101,15,51,126,22,122,28,84,10,66,144,12,135,32,101,14,61,137,7,162,41,85,21,79,172,12,179,35,107,18,80,179,9,187,43,100,14,72,166,11,167,27,99,17,71,187,13,191,39,105,18,69,178,12,194,31,90,21,63,178,13,183,44,92,23,70,168,12,177,47,96,13,61,154,15,220,49,93,13,56,143,17,183,38,83,13,41,142,13,236,44,68,16,36,141,10,219,42,53,24,31,143,13,186,42,50,19,27,126,13,224,35,38,28,30,135,12,186,32,49,25,35,163,11,210,30,53,30,21,164,19,199,32,43,39,28,160,21,189,34,46,29,58,175,29,158,20,85,32,50,176,20,168,20,86,40,43,193,38,200,39,79,45,46,166,37,223,29,79,46,23,164,22,266,31,44,31,12,156,32,252,28,30,55,23,155,40,260,25,42,59,11,146,31,238,19,27,68,9,150,24,258,22,27,85,18,130,27,258,32,25,63,20,148,36,244,32,44,82,16,148,38,250,26,36,79,20,152,24,246,27,26,64,22,151,39,231,30,35,65,20,160,27,248,38,32,72,13,184,33,230,41,38,62,19,178,31,243,43,22,83,18,172,40,255,34,39,78,25,166,31,265,41,33,83,26,190,45,278,57,38,108,33,213,45,256,59,52,131,29,204,31,289,44,40,109,35,252,49,339,55,56,94,37,249,42,332,67,50,132,37,239,37,324,63,63,134,21,232,41,321,65,50,97,37,250,46,330,76,68,120,30,240,74,347,77,75,137,32,254,60,381,84,95,147,41,309,94,435,97,141,161,52,281,84,493,116,165,159,52,352,98,493,127,194,162,49,404,133,555,161,217,144,61,451,133,634,160,279,160,85,562,156,694,184,408,154,89,561,175,793,207,449,169,82,582,196,837,211,468,176,81,591,249,929,245,533,180,94,642,261,899,215,555,147,56,597,258,805,169,480,43,10,123,35,137,37,54],"date":["1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01"]},"markers":null,"annotations":null,"offset":"silhouette","interactive":false,"interpolate":"cardinal","palette":"Spectral","text":"black","tooltip":"black","x_tick_interval":10,"x_tick_units":"year","x_tick_format":"%Y","y_tick_count":5,"y_tick_format":",g","top":20,"right":40,"bottom":30,"left":50,"legend":false,"legend_label":"","fill":"brewer","label_col":"black","x_scale":"date","sort":true,"order":"none"},"evals":[],"jsHooks":[]}</script>
<p>En este gráfico, la variable <em>tiempo</em> (en nuestro caso, <code>year</code>) se representa en el eje horizontal, y las franjas de colores corresponden, de abajo arriba, a los niveles ordenados del factor <code>genero</code>: la franja roja inferior a las películas de acción, la naranja inmediatamente superior a las de animación, y así hasta llegar a la franja azul de los cortometrajes. Su grueso, sobre cada año, representa el número de películas de cada género.</p>
<p>Por el momento, no se puede añadir fácilmente una leyenda al <em>streamgraph</em> producido en modo <code>interactive=FALSE</code>. Pero la gracia (que no podemos reproducir aquí pero sí que lo podéis hacer vosotros)
es producir el gráfico en modo interactivo, con <code>interactive=TRUE</code>. Entonces, al pasear el ratón sobre la figura nos muestra, en cada punto, qué categoría estamos consultando y el número de películas en ese año. Además, entrando</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">streamgraph</span>(sum.movies.agrup, <span class="st">&quot;genero&quot;</span>, <span class="st">&quot;valor&quot;</span>, <span class="st">&quot;year&quot;</span>,
   <span class="dt">interactive=</span><span class="ot">TRUE</span>)</code></pre>
<div id="htmlwidget-93fbac75a52de7ec4bdb" class="streamgraph html-widget" style="width:480px;height:480px;"></div>
<div id="htmlwidget-93fbac75a52de7ec4bdb-legend" style="width:480" class="streamgraph html-widget-legend"><center><label style='padding-right:5px' for='htmlwidget-93fbac75a52de7ec4bdb-select'></label><select id='htmlwidget-93fbac75a52de7ec4bdb-select' style='visibility:hidden;'></select></center></div>
<script type="application/json" data-for="htmlwidget-93fbac75a52de7ec4bdb">{"x":{"data":{"key":["Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short"],"value":[4,26,125,7,106,53,74,5,41,146,5,138,45,91,5,63,143,6,157,33,116,6,51,159,7,167,66,107,8,49,192,7,164,61,123,17,69,192,13,140,62,122,9,85,212,4,120,47,143,14,75,209,10,153,62,127,8,76,217,11,133,53,126,17,80,183,10,179,35,127,15,85,213,16,156,45,134,16,97,242,16,139,57,141,24,100,203,19,148,40,145,18,74,165,26,129,26,123,11,68,157,14,118,32,101,15,51,126,22,122,28,84,10,66,144,12,135,32,101,14,61,137,7,162,41,85,21,79,172,12,179,35,107,18,80,179,9,187,43,100,14,72,166,11,167,27,99,17,71,187,13,191,39,105,18,69,178,12,194,31,90,21,63,178,13,183,44,92,23,70,168,12,177,47,96,13,61,154,15,220,49,93,13,56,143,17,183,38,83,13,41,142,13,236,44,68,16,36,141,10,219,42,53,24,31,143,13,186,42,50,19,27,126,13,224,35,38,28,30,135,12,186,32,49,25,35,163,11,210,30,53,30,21,164,19,199,32,43,39,28,160,21,189,34,46,29,58,175,29,158,20,85,32,50,176,20,168,20,86,40,43,193,38,200,39,79,45,46,166,37,223,29,79,46,23,164,22,266,31,44,31,12,156,32,252,28,30,55,23,155,40,260,25,42,59,11,146,31,238,19,27,68,9,150,24,258,22,27,85,18,130,27,258,32,25,63,20,148,36,244,32,44,82,16,148,38,250,26,36,79,20,152,24,246,27,26,64,22,151,39,231,30,35,65,20,160,27,248,38,32,72,13,184,33,230,41,38,62,19,178,31,243,43,22,83,18,172,40,255,34,39,78,25,166,31,265,41,33,83,26,190,45,278,57,38,108,33,213,45,256,59,52,131,29,204,31,289,44,40,109,35,252,49,339,55,56,94,37,249,42,332,67,50,132,37,239,37,324,63,63,134,21,232,41,321,65,50,97,37,250,46,330,76,68,120,30,240,74,347,77,75,137,32,254,60,381,84,95,147,41,309,94,435,97,141,161,52,281,84,493,116,165,159,52,352,98,493,127,194,162,49,404,133,555,161,217,144,61,451,133,634,160,279,160,85,562,156,694,184,408,154,89,561,175,793,207,449,169,82,582,196,837,211,468,176,81,591,249,929,245,533,180,94,642,261,899,215,555,147,56,597,258,805,169,480,43,10,123,35,137,37,54],"date":["1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01"]},"markers":null,"annotations":null,"offset":"silhouette","interactive":true,"interpolate":"cardinal","palette":"Spectral","text":"black","tooltip":"black","x_tick_interval":10,"x_tick_units":"year","x_tick_format":"%Y","y_tick_count":5,"y_tick_format":",g","top":20,"right":40,"bottom":30,"left":50,"legend":false,"legend_label":"","fill":"brewer","label_col":"black","x_scale":"date","sort":true,"order":"none"},"evals":[],"jsHooks":[]}</script>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sg_legend</span>(<span class="kw">streamgraph</span>(sum.movies.agrup,<span class="st">&quot;genero&quot;</span>, 
   <span class="st">&quot;valor&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="dt">interactive=</span><span class="ot">TRUE</span>), <span class="dt">show=</span><span class="ot">TRUE</span>, 
    <span class="dt">label=</span><span class="st">&quot;Género: &quot;</span>)</code></pre>
<div id="htmlwidget-0f930f6b41a19a6a495c" class="streamgraph html-widget" style="width:480px;height:480px;"></div>
<div id="htmlwidget-0f930f6b41a19a6a495c-legend" style="width:480" class="streamgraph html-widget-legend"><center><label style='padding-right:5px' for='htmlwidget-0f930f6b41a19a6a495c-select'></label><select id='htmlwidget-0f930f6b41a19a6a495c-select' style='visibility:hidden;'></select></center></div>
<script type="application/json" data-for="htmlwidget-0f930f6b41a19a6a495c">{"x":{"data":{"key":["Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short","Action","Animation","Comedy","Documentary","Drama","Romance","Short"],"value":[4,26,125,7,106,53,74,5,41,146,5,138,45,91,5,63,143,6,157,33,116,6,51,159,7,167,66,107,8,49,192,7,164,61,123,17,69,192,13,140,62,122,9,85,212,4,120,47,143,14,75,209,10,153,62,127,8,76,217,11,133,53,126,17,80,183,10,179,35,127,15,85,213,16,156,45,134,16,97,242,16,139,57,141,24,100,203,19,148,40,145,18,74,165,26,129,26,123,11,68,157,14,118,32,101,15,51,126,22,122,28,84,10,66,144,12,135,32,101,14,61,137,7,162,41,85,21,79,172,12,179,35,107,18,80,179,9,187,43,100,14,72,166,11,167,27,99,17,71,187,13,191,39,105,18,69,178,12,194,31,90,21,63,178,13,183,44,92,23,70,168,12,177,47,96,13,61,154,15,220,49,93,13,56,143,17,183,38,83,13,41,142,13,236,44,68,16,36,141,10,219,42,53,24,31,143,13,186,42,50,19,27,126,13,224,35,38,28,30,135,12,186,32,49,25,35,163,11,210,30,53,30,21,164,19,199,32,43,39,28,160,21,189,34,46,29,58,175,29,158,20,85,32,50,176,20,168,20,86,40,43,193,38,200,39,79,45,46,166,37,223,29,79,46,23,164,22,266,31,44,31,12,156,32,252,28,30,55,23,155,40,260,25,42,59,11,146,31,238,19,27,68,9,150,24,258,22,27,85,18,130,27,258,32,25,63,20,148,36,244,32,44,82,16,148,38,250,26,36,79,20,152,24,246,27,26,64,22,151,39,231,30,35,65,20,160,27,248,38,32,72,13,184,33,230,41,38,62,19,178,31,243,43,22,83,18,172,40,255,34,39,78,25,166,31,265,41,33,83,26,190,45,278,57,38,108,33,213,45,256,59,52,131,29,204,31,289,44,40,109,35,252,49,339,55,56,94,37,249,42,332,67,50,132,37,239,37,324,63,63,134,21,232,41,321,65,50,97,37,250,46,330,76,68,120,30,240,74,347,77,75,137,32,254,60,381,84,95,147,41,309,94,435,97,141,161,52,281,84,493,116,165,159,52,352,98,493,127,194,162,49,404,133,555,161,217,144,61,451,133,634,160,279,160,85,562,156,694,184,408,154,89,561,175,793,207,449,169,82,582,196,837,211,468,176,81,591,249,929,245,533,180,94,642,261,899,215,555,147,56,597,258,805,169,480,43,10,123,35,137,37,54],"date":["1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1930-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1931-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1932-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1933-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1934-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1935-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1936-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1937-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1938-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1939-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1940-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1941-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1942-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1943-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1944-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1945-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1946-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1947-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1948-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1949-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1950-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1951-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1952-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1953-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1954-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1955-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1956-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1957-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1958-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1959-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1960-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1961-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1962-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1963-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1964-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1965-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1966-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1967-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1968-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1969-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1970-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1971-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1972-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1973-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1974-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1975-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1976-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1977-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1978-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1979-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1980-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1981-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1982-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1983-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1984-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1985-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1986-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1987-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1988-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1989-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1990-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1991-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1992-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1993-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1994-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1995-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1996-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1997-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1998-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","1999-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2000-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2001-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2002-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2003-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2004-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01","2005-01-01"]},"markers":null,"annotations":null,"offset":"silhouette","interactive":true,"interpolate":"cardinal","palette":"Spectral","text":"black","tooltip":"black","x_tick_interval":10,"x_tick_units":"year","x_tick_format":"%Y","y_tick_count":5,"y_tick_format":",g","top":20,"right":40,"bottom":30,"left":50,"legend":true,"legend_label":"Género: ","fill":"brewer","label_col":"black","x_scale":"date","sort":true,"order":"none"},"evals":[],"jsHooks":[]}</script>
<p>se añade a la figura un menú desplegable con los diferentes niveles del factor usado (en nuestro caso <code>genero</code>) que permite ver la evolución de ese nivel. Esta figura se puede guardar como imagen interactiva o como página web.</p>

<ul>
<li><p><code>VCorpus</code>, del paquete <code>tm</code>, sirve para cargar un conjunto de documentos en un <em>VCorpus</em>. Sus dos parámetros son:</p></li>
<li><p><code>x</code>: indica el lugar de donde se han de cargar los documentos. Algunos posibles valores:
<code>DirSource(&quot;directorio&quot;, encoding=...)</code> y <code>URISource(&quot;url&quot;, encoding=...)</code>.</p></li>
<li><p><code>readerControl</code>: se ha de igualar a una <code>list</code> de dos componentes: <code>reader</code>, que indica la función con la que se han de leer los documentos, y <code>language</code>, que indica el idioma de los documentos. Si los ficheros son de texto, no es necesario especificar la componente <code>reader</code>.</p></li>
<li><p><code>inspect</code>, del paquete <code>tm</code>, nos da el número de documentos de un <em>VCorpus</em> y, de cada uno de ellos, su formato y su número de caracteres.</p></li>
<li><p><code>writeLines(as.character(</code>documento<code>))</code> escribe el <em>documento</em> en la consola.</p></li>
<li><p><code>tm_map(VCorpus, &quot;transformación&quot;)</code>, del paquete <code>tm</code>, aplica la <em>transformación</em> a todos los documentos del <em>VCorpus</em>. Algunas transformaciones:</p>
<ul>
<li><p><code>tolower</code>: convierte todas las letras en minúsculas.</p></li>
<li><p><code>removePunctuation</code>: elimina los signos de puntuación.</p></li>
<li><p><code>removeWords</code>: elimina las palabras del vector que se especifique.</p></li>
<li><p><code>stripWhitespace</code>: elimina los espacios en blanco extra.</p></li>
<li><p><code>removeNumbers</code>: elimina los números.</p></li>
<li><p><code>stemDocument</code>: cargando el paquete <code>SnowballC</code>, se queda sólo con las raíces de algunas palabras.</p></li>
<li><p><code>stopwords</code>, del paquete <code>tm</code>, aplicada al nombre de un idioma, entrecomillado, produce una lista de palabras <em>comodín</em> de este idioma.</p></li>
</ul></li>
<li><p><code>wordcloud</code>, del paquete homónimo, produce una nube de palabras del documento al que se aplica. Algunos parámetros destacables:</p>
<ul>
<li><p><code>scale</code>: un vector de longitud 2 que sirve para indicar el tamaño relativo de las palabras de mayor y menor frecuencia.</p></li>
<li><p><code>max.words</code>: el número máximo de palabras a mostrar.</p></li>
<li><p><code>min.freq</code>: la frecuencia mínima necesaria para que una palabra aparezca en el gráfico.</p></li>
<li><p><code>rot.per</code>: la proporción de palabras que se pueden mostrar giradas 90 grados.</p></li>
<li><p><code>colors</code>: la paleta de colores usada para representar las frecuencias.</p></li>
</ul></li>
<li><p><code>heatmap</code> produce el mapa de calor, o <em>heatmap</em>, de la matriz a la que se aplica. Algunos parámetros importantes:</p>
<ul>
<li><p><code>Rowv</code> y <code>Colv</code>: igualados a <code>NA</code>, impiden que se añadan dendrogramas de las filas y las columnas en los márgenes.</p></li>
<li><p><code>revC</code>: igualado a <code>TRUE</code> invierte el orden de las columnas.</p></li>
</ul></li>
<li><p><code>corrplot</code>, del paquete homónimo, produce el <em>heatmap</em> de la matriz de correlaciones a la que se aplica.
Algunos parámetros importantes:</p>
<ul>
<li><p><code>method</code>: especifica la forma de las casillas; algunos valores posibles son <code>circle</code> (círculos, el valor por defecto), <code>square</code> (cuadrados), <code>shade</code> (la casilla sombreada).</p></li>
<li><p><code>addshade</code>: cuando usamos <code>method=shade</code>, permite especificar si queremos marcar las casillas correspondientes a correlación positiva o negativa (o ambas), mediante rectas de pendiente positiva o negativa.</p></li>
</ul>
<p>*<code>shade.col</code>: permite especificar el color de las rectas anteriores; igualado a <code>NA</code>, no las añade.</p>
<ul>
<li><p><code>tl.col</code>: el color de las etiquetas de filas y columnas.</p></li>
<li><p><code>tl.srt</code>: la inclinación de las etiquetas de filas y columnas.</p></li>
<li><p><code>addCoef.col</code>: igualado a un color, especifica que se escriban en cada casilla la entrada correspondiente de la matriz en ese color.</p></li>
<li><p><code>dist</code>, aplicada a una matriz o a un <em>data frame</em> de variables numéricas, calcula la matriz de distancias entre sus filas. El tipo de distancia se especifica con el parámetro <code>method</code> y por defecto es la euclídea.</p></li>
</ul></li>
<li><p><code>hclust</code> calcula un <em>clustering</em> jerárquico de una matriz de distancias calculada por medio de <code>dist</code>.
El parámetro <code>method</code> permite especificar el algoritmo concreto.</p></li>
<li><p><code>as.dendrogram</code> transforma el resultado de <code>hclust</code> en un dendrograma.</p></li>
<li><p><code>plot</code>, aplicado a un dendrograma, lo dibuja. En este contexto, aparte de los parámetros usuales, se dispone de varios parámetros específicos, entre los que destacamos:</p>
<ul>
<li><p><code>type=triangle</code>: dibuja las ramificaciones triangulares en vez de rectangulares.</p></li>
<li><p><code>horiz=TRUE</code>: dibuja el dendrograma horizontal.</p></li>
<li><p><code>labels</code>, aplicada a un dendrograma, nos da las etiquetas de sus hojas de izquierda a derecha y, si está cargado el paquete <code>dendextend</code>, permite también cambiar los nombres de estas etiquetas.</p></li>
</ul></li>
<li><p><code>set(dendrograma, what=&quot;característica&quot;, valor)</code>, del paquete
<code>dendextend</code>, permite modificar la <em>característica</em> del <em>dendrograma</em>. Algunas características útiles:</p>
<ul>
<li><code>labels</code>: los nombres de las etiquetas.</li>
<li><code>labels_col</code>: los colores de las etiquetas.</li>
<li><code>labels_cex</code>: el tamaño de las etiquetas.</li>
</ul></li>
</ul>
<p>La lista completa se puede consultar en la Ayuda de la función.</p>
<ul>
<li><p><code>%&gt;%</code> permite indicar la aplicación sucesiva de funciones, cada una al resultado de la aplicación anterior. Así
<code>x%&gt;%f(Y)%&gt;%g(Z)</code>
toma el objeto <code>x</code>, le aplica la función <code>f</code> con parámetros <code>Y</code> y al resultado le aplica la función <code>g</code> con parámetros <code>Z</code>; es decir, calcula <code>g(f(x,Y),Z)</code>. Esta notación solo está disponible en algunos paquetes (por ejemplo, <code>dendextend</code> y <code>streamgraph</code>).</p></li>
<li><p><code>circlize_dendrogram</code>, del paquete <code>circlize</code>, dibuja un dendrograma en forma circular.</p></li>
<li><p><code>symbols(x, y, parámetro_figura=z)</code> dibuja, en cada uno de los puntos de abscisa una entrada del vector <code>x</code> y ordenada la correspondiente entrada del vector <code>y</code>, una figura del tipo especificado por el <code>parámetro_figura</code>.
(<code>circles</code> para círculos, <code>squares</code> para cuadrados, <code>stars</code> para estrellas, etc.)
de dimensión lineal la especificada por la entrada correspondiente del vector <span class="math inline">\(z\)</span>. Otros parámetros de interés, aparte de los usuales de la función <code>plot</code>:</p>
<p>*<code>fg</code>: el color de la frontera de los símbolos.</p>
<p>*<code>bg</code>: su color de relleno.</p></li>
<li><p><code>install_github(&quot;url&quot;)</code>, del paquete <code>devtools</code>, instala un paquete del que conocemos su <em>url</em> en <em>GitHub</em>.</p></li>
<li><p><code>gather</code>, del paquete <code>tidyr</code>, sustituye en un <em>data frame</em> un conjunto de variables numéricas por dos variables: un factor cuyos niveles son los nombres de las variables numéricas originales y una variable numérica nueva que da, para cada nivel de ese factor, el valor de la variable original. De esta manera, cada fila del <em>data frame</em> original se desdobla en tantas filas como variables hemos agrupado en el nuevo factor.</p></li>
<li><p><code>streamgraph</code>, del paquete homónimo, dibuja el <em>streamgraph</em> de tres variables de un <em>data frame</em>: una variable temporal, un factor, y una variable que para cada valor de la variable temporal y para cada nivel del factor nos da un valor numérico. Dispone del parámetro <code>interactive</code>, que igualado a <code>FALSE</code> produce un gráfico estático e igualado a <code>TRUE</code> produce un gráfico interactivo.</p></li>
<li><p><code>sg_legend</code>, del paquete <code>streamgraph</code>, aplicada a un <em>streamgraph</em> producido en modo interactivo y a los parámetros <code>show=TRUE</code> y <code>label</code> igualado a un nombre que represente el factor del <em>streamgraph</em>, añade un menú desplegable con los diferentes valores del factor.</p></li>
</ul>

</div>
</div>










<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Que podréis encontrar, por ejemplo, en la correspondiente entrada de la Wikipedia: <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes"></a>.<a href="graficos-avanzados.html#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Copiado de <a href="http://www.boe.es/diario_boe/txt.php?id=BOE-A-2013-12886">http://www.boe.es/diario_boe/txt.php?id=BOE-A-2013-12886</a><a href="graficos-avanzados.html#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Para más información sobre algoritmos de <em>clustering</em>, podéis consultar <a href="http://en.wikipedia.org/wiki/Cluster_analysis">http://en.wikipedia.org/wiki/Cluster_analysis</a><a href="graficos-avanzados.html#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Esta notación no se puede usar en la instalación básica de R, solo en los paquetes, como <code>dendextend</code>, que la aceptan.<a href="graficos-avanzados.html#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>Mayo de 2016. A lo mejor cuando leáis estas notas, sí.<a href="graficos-avanzados.html#fnref5" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"download": ["pdf", "epub"]
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
